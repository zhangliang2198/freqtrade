# 开单额度限制 - 快速参考

## 📝 配置位置

**文件**: `user_data/llm_deepseek.json`

**当前配置**:
```json
{
    "decision_points": {
        "stake": {
            "max_stake_per_trade": {
                "mode": "percent",
                "value": 5  // 5% 可用余额
            }
        }
    }
}
```

## 🎯 快速修改

### 改为 20%（推荐）
```json
"value": 20
```

### 改为固定 $100
```json
"mode": "fixed",
"value": 100
```

### 禁用限制
```json
"max_stake_per_trade": null
```
或直接删除该配置项

## 📊 常见配置对比

| 百分比 | 风险等级 | 可分散交易对 | 适用场景 |
|--------|---------|-------------|----------|
| 5%     | 极保守   | 20+         | 测试/学习 |
| 10%    | 保守     | 10          | 稳健投资 |
| 15%    | 中等     | 6-7         | 平衡策略 |
| 20%    | 平衡     | 5           | **推荐** |
| 25%    | 激进     | 4           | 高信心信号 |
| 30%+   | 非常激进 | 3-4         | 专业交易员 |

## 💡 效果示例

### 可用余额 $1000, 配置 5%

| LLM 倍数 | 计算结果 | 实际开单 | 是否被限制 |
|---------|---------|---------|----------|
| 0.5x    | $20     | $20     | ❌ 未超限 |
| 1.0x    | $40     | $40     | ❌ 未超限 |
| 1.5x    | $60     | **$50** | ✅ 被限制 |
| 2.0x    | $80     | **$50** | ✅ 被限制 |
| 5.0x    | $200    | **$50** | ✅ 被限制 |

最大额度 = $1000 × 5% = **$50**

### 可用余额 $1000, 配置 20%

| LLM 倍数 | 计算结果 | 实际开单 | 是否被限制 |
|---------|---------|---------|----------|
| 0.5x    | $20     | $20     | ❌ 未超限 |
| 1.0x    | $40     | $40     | ❌ 未超限 |
| 1.5x    | $60     | $60     | ❌ 未超限 |
| 2.0x    | $80     | $80     | ❌ 未超限 |
| 5.0x    | $200    | **$200** | ✅ 刚好到限 |
| 10.0x   | $400    | **$200** | ✅ 被限制 |

最大额度 = $1000 × 20% = **$200**

## 🔍 如何知道限制生效

### 查看日志

```bash
grep "开单额度受限" logs/*.log
```

**输出示例**:
```
2025-01-11 10:30:15 - INFO - 📊 BTC/USDT 开单额度受限于可用余额的 5%: 80.00 -> 50.00 USDT
```

### 检查实际订单

如果多个订单的开单金额都是相同的最大值，说明限制正在生效。

## 🏦 账户分离模式

**配置保持不变**，系统会自动处理：

- **开多单**: 使用多头账户余额计算
- **开空单**: 使用空头账户余额计算

**示例**:
- 多头账户: $5000 × 5% = $250
- 空头账户: $3000 × 5% = $150

同样的 5% 配置，但实际限制不同！

## ⚠️ 重要提醒

1. **百分比是基于可用余额**，不是总余额
2. **配置修改后需要重启**策略才能生效
3. **LLM 会看到限制**，但代码会强制执行
4. **账户分离模式下**，多空限制可能不同

## 📈 调整建议

### 测试阶段
```json
"value": 5  // 保守测试
```

### 稳定运行后
```json
"value": 15  // 逐步提高
```

### 成熟策略
```json
"value": 20  // 平衡配置
```

### 大资金账户
```json
"mode": "fixed",
"value": 1000  // 固定限额
```

## 🔗 相关文档

- 详细说明: `docs/MAX_STAKE_PER_TRADE.md`
- 提示词示例: `docs/PROMPT_MAX_STAKE_EXAMPLE.md`
- 实现总结: `FEATURE_MAX_STAKE_SUMMARY.md`
- 配置示例: `config_examples/config_llm_max_stake.example.json`

## 🚀 立即使用

1. 编辑 `user_data/llm_deepseek.json`
2. 修改 `value` 值（建议 10-20）
3. 重启策略
4. 观察日志中的限制提示

**当前设置 5% 比较保守，建议根据实际情况调整到 15-20%！**
